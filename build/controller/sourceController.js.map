{"version":3,"sources":["../../server/controller/sourceController.js"],"names":["newsapi","NewsAPI","process","env","NEWS_API","callSources","req","res","response","v2","sources","language","country","category","answer","Source","findOrCreateWithCat","status","send","cachedSources","JSON","stringify","client","set","showSource","id","params","source","findById","populate","path","select","exec","err","posts","articles","reverse","undefined","searchSources","find","RegExp","body"],"mappings":";;;;;;;AAAA;;AAEA;;AACA;;AACA;;;;AAHA,MAAMA,OAAO,GAAG,IAAIC,gBAAJ,CAAYC,OAAO,CAACC,GAAR,CAAYC,QAAxB,CAAhB;;AAMO,MAAMC,WAAW,GAAG,OAAOC,GAAP,EAAYC,GAAZ,KAAoB;AAC7C,MAAIC,QAAQ,GAAG,MAAMR,OAAO,CAACS,EAAR,CAAWC,OAAX,CAAmB;AACtCC,IAAAA,QAAQ,EAAE,IAD4B;AAEtCC,IAAAA,OAAO,EAAE,IAF6B;AAGtCC,IAAAA,QAAQ,EAAE;AAH4B,GAAnB,CAArB;AAMA,MAAIC,MAAM,GAAG,MAAM,mCAAaN,QAAQ,CAACE,OAAtB,EAA+BK,eAAOC,mBAAtC,CAAnB;AAEAT,EAAAA,GAAG,CAACU,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBJ,MAArB,EAT6C,CAW7C;AACA;AACA;;AAGA,MAAIK,aAAa,GAAGC,IAAI,CAACC,SAAL,CAAeP,MAAf,CAApB;;AACAQ,iBAAOC,GAAP,CAAW,SAAX,EAAsBJ,aAAtB;AACD,CAlBM;;;;AAoBA,MAAMK,UAAU,GAAG,CAAClB,GAAD,EAAMC,GAAN,KAAc;AACtC,QAAMkB,EAAE,GAAGnB,GAAG,CAACoB,MAAJ,CAAWD,EAAtB;;AACA,MAAIE,MAAM,GAAGZ,eAAOa,QAAP,CAAgBH,EAAhB,CAAb;;AACAE,EAAAA,MAAM,CACLE,QADD,CACU;AAACC,IAAAA,IAAI,EAAE,UAAP;AAAmBC,IAAAA,MAAM,EAAE;AAA3B,GADV,EAECC,IAFD,CAEM,CAACC,GAAD,EAAMC,KAAN,KAAgB;AACpBA,IAAAA,KAAK,CAACC,QAAN,CAAeC,OAAf;AACA7B,IAAAA,GAAG,CAACU,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBE,IAAI,CAACC,SAAL,CAAea,KAAf,EAAsBG,SAAtB,EAAiC,CAAjC,CAArB;AACD,GALD;AAMD,CATM;;;;AAYA,MAAMC,aAAa,GAAG,OAAOhC,GAAP,EAAYC,GAAZ,KAAoB;AAC/C,MAAIG,OAAO,GAAG,MAAMK,eAAOwB,IAAP,CAAY;AAACd,IAAAA,EAAE,EAAE,IAAIe,MAAJ,CAAWlC,GAAG,CAACmC,IAAJ,CAASd,MAApB;AAAL,GAAZ,CAApB;AACApB,EAAAA,GAAG,CAACU,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBR,OAArB;AACD,CAHM","sourcesContent":["import NewsAPI from 'newsapi';\nconst newsapi = new NewsAPI(process.env.NEWS_API);\nimport { Source }  from '../models';\nimport { asyncMapping } from './connectingFuncs'\nimport { client } from '../config/config'\n\n\nexport const callSources = async (req, res) => {\n  let response = await newsapi.v2.sources({\n    language: 'en',\n    country: 'us',\n    category: \"general\"\n  })\n\n  let answer = await asyncMapping(response.sources, Source.findOrCreateWithCat)\n\n  res.status(200).send(answer)\n\n  // Redis Caching for news sources\n  // a lot of work is done to fetch their sources\n  // and to get their pictures\n\n\n  let cachedSources = JSON.stringify(answer)\n  client.set('sources', cachedSources)\n};\n\nexport const showSource = (req, res) => {\n  const id = req.params.id;\n  let source = Source.findById(id)\n  source\n  .populate({path: 'articles', select: \"author title description url urlToImage content\"})\n  .exec((err, posts) => {\n    posts.articles.reverse()\n    res.status(200).send(JSON.stringify(posts, undefined, 2));\n  });\n}\n\n\nexport const searchSources = async (req, res) => {\n  let sources = await Source.find({id: new RegExp(req.body.source)})\n  res.status(200).send(sources)\n}\n"],"file":"sourceController.js"}